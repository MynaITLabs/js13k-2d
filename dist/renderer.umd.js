!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Renderer=n()}(this,function(){var t=function(t,n){this.c=t,this.p=null,this.n=n,this.d=0};t.prototype.r=function(){this.d=1};var n=function(){this.h=null};n.prototype.add=function(n){var e=new t(n,this.h);return this.h&&(this.h.p=e),this.h=e,e},n.prototype.i=function(t){for(var n=this.h;n;)n.d?(n.p?n.p.n=n.n:this.h=n.n,n.n&&(n.n.p=n.p)):t(n.c),n=n.n};var e=function(t,n){this.set(t,n)};e.prototype.set=function(t,n){return this.x=t||0,this.y=n||(0!==n?this.x:0),this},e.prototype.copy=function(t){return this.set(t.x,t.y)},e.prototype.clone=function(){return new e(this.x,this.y)};var r=function(t){this.l=new n,this.z=t};r.prototype.add=function(t){t.n=this.l.add(t),t.z=this.z};var i=function(t){this.bitmap=t,this.anchor=new e,this.position=new e,this.scale=new e(1),this.rotation=0,this.tint=16777215,this.alpha=1,this.visible=!0,this.n=null};i.prototype.remove=function(){this.n&&this.n.r()};var a=function(t,i){var a=t.getContext("webgl",i),o=a.getExtension("ANGLE_instanced_arrays"),u=function(t,n){var e=a.createShader(n);return a.shaderSource(e,t),a.compileShader(e),e},c=function(t,n,e){var r=a.createBuffer();return a.bindBuffer(t,r),a.bufferData(t,n,e||35044),r},f=[],h={gl:a,camera:{at:new e,to:new e,angle:0},bkg:function(t,n,e,r){void 0===r&&(r=1),a.clearColor(t,n,e,r)},texture:function(t,n,e){var r=Object.assign({10240:9729,10241:9729,10242:33071,10243:33071},e),i=a.createTexture();return a.bindTexture(3553,i),Object.keys(r).forEach(function(t){return a.texParameteri(3553,t,r[t])}),a.texImage2D(3553,0,6408,6408,5121,t),i.a=n||.001,{tex:i,w:t.width,h:t.height,u:[0,0,1,1]}},bitmap:function(t,n,e,r,i){return{tex:t.tex,w:r,h:i,u:[n/t.w,e/t.h,r/t.w,i/t.h]}},layer:function(t){var n=f.find(function(n){return n.z===t});return n||(n=new r(t),f.push(n),f.sort(function(t,n){return t.z<n.z?1:-1})),n}},s=h.layer(0);h.add=function(t){s.add(t)};var v=function(t,n){var e=u(t,35633),r=u(n,35632),i=a.createProgram();return a.attachShader(i,e),a.attachShader(i,r),a.linkProgram(i),i}("attribute vec2 g;\nattribute vec2 a;\nattribute vec2 t;\nattribute float r;\nattribute vec2 s;\nattribute vec4 u;\nattribute vec4 c;\nattribute float z;\nuniform mat4 m;\nvarying vec2 v;\nvarying vec4 i;\nvoid main(){\nv=u.xy+g*u.zw;\ni=c.abgr;\nvec2 p=(g-a)*s;\nfloat q=cos(r);\nfloat w=sin(r);\np=vec2(p.x*q-p.y*w,p.x*w+p.y*q);\np+=a+t;\ngl_Position=m*vec4(p,z,1);}","precision mediump float;\nuniform sampler2D x;\nuniform float j;\nvarying vec2 v;\nvarying vec4 i;\nvoid main(){\nvec4 c=texture2D(x,v);\nif(c.a<j)discard;\ngl_FragColor=c*i;\n}"),p=function(t,n,e,r,i,u,c){var f=a.getAttribLocation(v,t);return a.enableVertexAttribArray(f),a.vertexAttribPointer(f,n,u||5126,!!c,e||0,i||0),r&&o.vertexAttribDivisorANGLE(f,r),f};c(34963,new Uint16Array([0,1,2,2,1,3])),c(34962,new Float32Array([0,0,0,1,1,0,1,1])),p("g",2);var l=new ArrayBuffer(3407820),d=new Float32Array(l),y=new Uint32Array(l);c(34962,l,35048),p("a",2,52,1),p("s",2,52,1,8),p("r",1,52,1,16),p("t",2,52,1,20),p("u",4,52,1,28),p("c",4,52,1,44,5121,!0),p("z",1,52,1,48);var x,b=function(t){return a.getUniformLocation(v,t)},m=b("m"),g=b("x"),w=b("j"),A=0,z=function(){A&&(a.bufferSubData(34962,0,d.subarray(0,13*A)),o.drawElementsInstancedANGLE(4,6,5123,0,A),A=0)},E=function(t){if(t.visible){65535===A&&z();var n=t.bitmap,e=n.tex,r=n.w,i=n.h,o=n.u;x!==e&&(z(),x=e,a.bindTexture(3553,e),a.uniform1i(g,e),a.uniform1f(w,e.a));var u=13*A;d[u++]=t.anchor.x,d[u++]=t.anchor.y,d[u++]=t.scale.x*r,d[u++]=t.scale.y*i,d[u++]=t.rotation,d[u++]=t.position.x,d[u++]=t.position.y,d[u++]=o[0],d[u++]=o[1],d[u++]=o[2],d[u++]=o[3],y[u++]=((16777215&t.tint)<<8|255*t.alpha&255)>>>0,d[u++]=-t.z,A++}};return h.render=function(){var e=t.clientWidth,r=t.clientHeight;t.width=e,t.height=r,a.viewport(0,0,e,r),a.disable(3042),a.enable(2929),a.depthFunc(513),a.clear(16640);var i=h.camera,o=i.at,u=i.to,c=i.angle,s=o.x-e*u.x,p=o.y-r*u.y,l=Math.cos(c),d=Math.sin(c),y=2/e,b=-2/r,g=[l*y,d*b,0,0,-d*y,l*b,0,0,0,0,1e-5,0,(o.x*(1-l)+o.y*d)*y+-(2*s+e)/e,(o.y*(1-l)-o.x*d)*b+(2*p+r)/r,0,1];a.useProgram(v),a.activeTexture(33984),a.uniformMatrix4fv(m,!1,g),x=null;var A=new n;f.forEach(function(t){t.l.i(function(t){1!==t.alpha?A.add(t):E(t)})}),z(),a.enable(3042),a.blendFunc(1,771),a.depthFunc(515),a.uniform1f(w,.001),A.i(function(t){return E(t)}),z()},h.render(),h};return a.Sprite=i,a.Point=e,a});
